---
"id": "ah-7c72"
"status": "closed"
"deps":
- "ah-a07b"
"links": []
"created": "2026-02-19T22:39:39Z"
"type": "task"
"priority": 2
"assignee": "Connor"
"parent": "ah-c3c2"
"tags":
- "sprint:map-perf-architecture"
"external": {}
---
# Integrate Protomaps basemap

## Problem
The map has no basemap - just a flat beige background. A hunting map needs proper cartography (roads, water, labels, land use) to provide context.

## Solution
Integrate Protomaps - a free, open-source vector basemap served as a single PMTiles file.

## Scope
- Download Arizona-region Protomaps basemap
- Add as vector source to map
- Apply style theme
- Remove redundant custom layers that basemap already provides
- Update layer ordering to interleave basemap with overlays

## Non-goals
- Satellite imagery (user confirmed not needed)
- Terrain/hillshade (can be added later)
- Custom styling of basemap

## Layer Overlap Analysis

| Current Custom Layer | Basemap Has? | Decision |
|---|---|---|
| roads.pmtiles | Yes (OSM roads) | **Keep** - enriched with `land_status`, `gmu` attributes |
| water.pmtiles | Yes | **Drop** - use basemap water |
| landcover.pmtiles | Yes (land use) | **Drop** - use basemap land use |
| buildings.pmtiles | Yes | **Drop** - use basemap buildings |
| places.pmtiles | Partially | **Evaluate** - trailheads may not be in OSM |

## Implementation Plan

1. **Download Protomaps Arizona extract**:
   ```bash
   # Use pmtiles extract to get Arizona region from world basemap
   pmtiles extract \
     https://build.protomaps.com/20250218.pmtiles \
     frontend/public/data/basemap.pmtiles \
     --bbox=-115.5,30.5,-108.0,37.5
   ```
   Or download pre-built extract if available.

2. **Add basemap source in `frontend/src/App.jsx`**:
   ```js
   map.addSource('basemap', {
     type: 'vector',
     url: 'pmtiles:///data/basemap.pmtiles'
   });
   ```

3. **Add basemap layers** (using Protomaps style spec):
   - `basemap-background` - background fill
   - `basemap-earth` - land fill
   - `basemap-landuse` - parks, forests, etc.
   - `basemap-water` - water bodies
   - `basemap-buildings` - building footprints
   - `basemap-roads` - road network
   - `basemap-places` - place labels
   - `basemap-labels` - street/POI labels

4. **Remove redundant custom sources/layers**:
   - Remove `water` source and `water-fill` layer
   - Remove `landcover` source and `landcover-fill` layer
   - Remove `buildings` source and `buildings-fill` layer

5. **Update layer ordering** (bottom to top):
   ```
   basemap-background
   basemap-earth
   basemap-landuse
   land-ownership-fill (overlay)
   hunt-units-fill (overlay)
   basemap-water
   roads-line (enriched custom layer)
   basemap-buildings
   basemap-roads (for minor roads not in custom layer)
   basemap-labels
   places-circle (if keeping custom POIs)
   ```

6. **Update Makefile** to download basemap in pipeline.

## Verification Commands
```bash
make dev-frontend
# Verify basemap renders with roads, water, labels
# Verify hunt units and land ownership still render on top
# Verify layer toggles still work
```

## Risks/Edge Cases
- Protomaps basemap may not have all trailheads/POIs needed
- Layer ordering may need iteration to get right z-index
- Basemap file size (Arizona extract should be ~50-100MB)

## Acceptance Criteria

Arizona Protomaps basemap downloaded as PMTiles; basemap source added to map; redundant custom layers (water, landcover, buildings) removed; layer ordering updated

## Notes

**2026-02-20T01:14:23Z**

Completed: Downloaded Arizona Protomaps basemap (609MB). Added @protomaps/basemaps package. Updated App.jsx with basemap layers using light flavor. Removed redundant water/landcover/buildings layers. Updated LayerPanel. Removed old PMTiles (saved 683MB). Added basemap target to Makefile.
