---
"id": "ah-174b"
"status": "closed"
"deps": []
"links": []
"created": "2026-02-18T01:53:14Z"
"type": "task"
"priority": 1
"assignee": "Connor"
"tags":
- "sprint:map-display-fix"
- "fanout"
"external": {}
---
# Sprint prep: map display fix

Objective:
the localhost viewing via make dev-frontend is showing the legend, but no map whatsoever. the app is not complete until i can view the ultimate product

## Sprint Brief

### Objective restatement
The frontend at `make dev-frontend` shows only the legend panel - no map renders at all. The user needs to see the complete hunting access map for Arizona.

### Sprint focus (2-5 words)
**Run data pipeline, fix map**

### Why this sprint focus is the best next step
**Root cause identified**: The map doesn't render because **no data files exist** in `frontend/public/data/`. The data pipeline (`make all`) has never been run - all data directories (`data/raw`, `data/processed`, `data/tiles`) are empty (only `.gitkeep` files).

The frontend code expects:
- PMTiles: `roads.pmtiles`, `water.pmtiles`, `landcover.pmtiles`, `buildings.pmtiles`, `places.pmtiles`
- GeoJSON: `azgfd_gmu.geojson`, `blm_sma_az.geojson`

Without these files, MapLibre has no sources to render. The legend panel renders because it's static React components, but the map container has no data to display.

### Current state

**Existing tickets that matter:**
- `ah-58db`: Fix land ownership GeoJSON format (ArcGIS JSON rings → GeoJSON coordinates) - WILL BE NEEDED after pipeline runs
- `ah-a536` / `ah-ad64`: Fix BLM SMA missing BLM and State Trust land - WILL BE NEEDED for complete land ownership data

These tickets address data quality issues, but the **primary blocker** is that the pipeline hasn't run at all.

**Codebase state:**
- Git: clean (no uncommitted changes, only untracked `.opencode/node_modules`)
- Frontend: Complete React app with MapLibre, LayerPanel, UnitInfoPanel
- Pipeline: Complete 4-step pipeline (download → clip → enrich → tiles)
- Data: **EMPTY** - all data directories only have `.gitkeep` files
- tippecanoe: Installed (v2.79.0)

### Risks + unknowns (and how we'll resolve them)

1. **Pipeline download failures** - The BLM SMA API may fail for BLM/State layers (known issue per ah-a536)
   - Resolution: If downloads fail, we'll still get partial data that renders some layers

2. **ArcGIS JSON format** - BLM SMA may export in ArcGIS format (per ah-58db)
   - Resolution: Include format fix as part of the enrichment step

3. **Large data files** - Overture data may be too large to process
   - Resolution: The code already has `LARGE_LAYER_THRESHOLD` handling (100MB skip)

4. **Browser console errors** - May reveal additional issues after pipeline runs
   - Resolution: Test with `make dev-frontend` and check console

## Ticket Set

Create the sprint tickets directly. This sprint prep ticket should be the parent.
- Tag rule: include `sprint:map-display-fix` on sprint tickets.
- Prefer: `loom ticket create ... --parent <THIS_TICKET_ID> --acceptance "..."`

Ticket quality rubric (non-negotiable):
- Scope + explicit non-goals
- Step-by-step implementation plan (include file paths when possible)
- Acceptance criteria (observable outcomes)
- Verification commands (use `uv run ...` for Python)
- Risks/edge cases
- Dependencies + suggested ordering (use `loom ticket dep-add`)

## Output

### Created/updated ticket IDs
- `ah-2fa8`: Run full data pipeline to generate map data (P1)
- `ah-d095`: Fix ArcGIS JSON format in BLM SMA data (P2)
- `ah-ed69`: Verify map renders with all layers (P1)
- `ah-850a`: Investigate and optimize data pipeline performance (P2)

### Suggested ordering + parallelization

**Critical path (must be sequential):**
```
ah-2fa8 (pipeline) → ah-d095 (fix format) → ah-ed69 (verify)
```

**Parallelization opportunities:**
```
ah-2fa8 ──┬──→ ah-d095 ──→ ah-ed69
          │
          └──→ ah-850a (can run in parallel with ah-d095)
```

**Rationale:**
1. `ah-2fa8` MUST run first - no data = no map
2. `ah-d095` depends on `ah-2fa8` - needs raw data to check format
3. `ah-ed69` depends on `ah-2fa8` + `ah-d095` - final verification
4. `ah-850a` depends on `ah-2fa8` - can run in parallel with `ah-d095` in separate worktree

**Worker assignment recommendation:**
- Worker 1: `ah-2fa8` → then `ah-d095`
- Worker 2: `ah-850a` (after `ah-2fa8` completes) - can use separate worktree
- Worker 1: `ah-ed69` (final step)

**Existing related tickets (not sprint-tagged, can be closed):**
- `ah-58db` - Superseded by `ah-d095`
- `ah-a536`, `ah-ad64` - Partially addressed; remaining work is data source issue (BLM API limitations)

Sprint name: map display fix
Sprint tag: sprint:map-display-fix
