---
"id": "ah-1494"
"status": "closed"
"deps": []
"links": []
"created": "2026-02-17T18:44:44Z"
"type": "task"
"priority": 1
"assignee": "Connor"
"tags":
- "sprint:fix-make-all"
- "fanout"
"external": {}
---
# Sprint prep: fix-make-all

Objective:
Get a working run of the make all command which is currently failing on the uv run python pipeline/03_enrich.py

---

## Sprint Brief

### Objective Restatement
Get a complete, successful run of `make all` that produces all expected data products (processed parquet files, PMTiles, frontend build) without errors.

### Sprint Focus (4 words)
Fix clip and enrich

### Why This Sprint Focus Is the Best Next Step
The `make all` pipeline is broken at the clip step (02_clip_arizona.py), which blocks the enrich step (03_enrich.py). Without these working, no downstream tiles or frontend data can be produced. The root causes are:
1. Empty/corrupt `overture_buildings_az.parquet` (0 bytes)
2. Missing `overture_places_az.parquet` (download never completed)
3. Clip script fails hard on these issues instead of skipping gracefully
4. BLM SMA data is in ArcGIS format (`rings`) instead of GeoJSON (`coordinates`)
5. BLM SMA is missing critical BLM and State Trust land (API 500 errors)

### Current State

**Existing tickets that matter:**
- `ah-58db` - Fix land ownership GeoJSON format (linked to new ah-5767)
- `ah-a536` - Fix BLM SMA data to include BLM and State Trust land (linked to new ah-ad64)
- Both had broken dependencies - now fixed

**Codebase state:**
- `data/raw/` has most files but:
  - `overture_buildings_az.parquet` is 0 bytes (empty/corrupt)
  - `overture_places_az.parquet` doesn't exist
  - `blm_sma_az.geojson` uses ArcGIS `rings` format
- `data/processed/` has partial clip outputs (transportation, water, land layers)
- Clip step fails on buildings (empty file) before getting to places (missing)
- Enrich step fails because clip never completed fully

**Git status:** Clean on team branch

### Risks + Unknowns (and how we'll resolve them)

1. **Overture downloads timing out?** 
   - The buildings download produced a 0-byte file, likely a timeout
   - Resolution: Places is separate ticket; buildings can be skipped for MVP

2. **BLM API 500 errors**
   - Layers 7 (BLM) and 14 (STATE) return 500 errors
   - Resolution: Tile the state into smaller bounding boxes (ah-ad64)

3. **ArcGIS rings format**
   - Geopandas should handle this on read, but need to verify (ah-5767)
   - Resolution: Test reading with geopandas; if fails, add explicit conversion

4. **Buildings optional for MVP**
   - Buildings are not critical for hunt planner
   - Places are needed for POI filtering in enrich (ah-0094)

---

## Ticket Set

### Created Sprint Tickets

| ID | Title | Priority | Deps |
|----|-------|----------|------|
| ah-6136 | Fix 02_clip_arizona.py to skip empty/missing files | P1 | none |
| ah-0094 | Download missing Overture places data | P1 | none |
| ah-5767 | Verify ArcGIS rings format is readable by geopandas | P2 | none |
| ah-ad64 | Fix BLM SMA missing BLM and State Trust land | P2 | none |
| ah-6781 | Run enrich step successfully | P1 | ah-6136, ah-0094, ah-5767 |
| ah-dbe7 | Run make all successfully (final verification) | P1 | ah-6781 |

### Related Existing Tickets (cleaned up)
- ah-58db: ArcGIS format issue (linked to ah-5767, broken dep removed)
- ah-a536: BLM land issue (linked to ah-ad64, broken dep removed)

---

## Output

### Created/Updated Ticket IDs
- ah-6136, ah-0094, ah-5767, ah-ad64, ah-6781, ah-dbe7 (new sprint tickets)
- ah-58db, ah-a536 (existing tickets - cleaned up broken deps, linked to replacements)

### Suggested Ordering + Parallelization

**Wave 1 (can run in parallel - no deps):**
- ah-6136: Fix clip script to skip empty/missing files
- ah-0094: Download places data
- ah-5767: Verify ArcGIS format readable
- ah-ad64: Fix BLM SMA missing land (optional, can be deferred)

**Wave 2 (after Wave 1 completes):**
- ah-6781: Run enrich step (depends on ah-6136, ah-0094, ah-5767)

**Wave 3 (after Wave 2 completes):**
- ah-dbe7: Run make all - final verification

**Note on ah-ad64:** This ticket (BLM/State land fix) is optional for the MVP. The enrich will run without it, just with incomplete land_status values. It can be done in parallel or deferred to a later sprint.

---

Sprint name: fix-make-all
Sprint tag: sprint:fix-make-all
