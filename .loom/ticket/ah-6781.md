---
"id": "ah-6781"
"status": "open"
"deps":
- "ah-0094"
- "ah-5767"
- "ah-6136"
"links": []
"created": "2026-02-17T18:57:31Z"
"type": "task"
"priority": 1
"assignee": "Connor"
"parent": "ah-1494"
"tags":
- "sprint:fix-make-all"
"external": {}
---
# Run enrich step successfully

# Run enrich step successfully

## Objective Alignment
The enrich step is the core data transformation that adds land ownership and hunt unit data to roads. This is the primary value of the pipeline.

## Problem
The \`03_enrich.py\` script currently fails because:
1. Required input files don't exist (clip step incomplete)
2. Places data is missing (download incomplete)

## Scope
- Run \`03_enrich.py\` successfully after prerequisites are met
- Verify output files are created correctly

## Non-goals
- Fix underlying data issues (separate tickets)
- Modify enrich logic

## Dependencies
- Depends on: clip step completing (buildings/places can be missing)
- Depends on: places data existing
- Depends on: BLM SMA being readable (geopandas test)

## Implementation Plan

1. Verify prerequisites:
   - \`data/processed/overture_transportation_clipped.parquet\` exists
   - \`data/processed/overture_places_clipped.parquet\` exists (or enrich handles missing)
   - \`data/raw/blm_sma_az.geojson\` is readable

2. Run enrich:
\`\`\`bash
uv run python pipeline/03_enrich.py
\`\`\`

3. Verify outputs

## Acceptance Criteria
- [ ] \`data/processed/roads_enriched.parquet\` exists with > 0 features
- [ ] Roads have \`land_status\` column with values like "public_blm", "public_usfs", etc.
- [ ] Roads have \`GMUNAME\` column from spatial join with GMUs
- [ ] \`data/processed/places_hunt.parquet\` exists (may be empty if no places)

## Verification Commands
\`\`\`bash
# Run enrich
uv run python pipeline/03_enrich.py

# Verify roads output
uv run python -c "
import geopandas as gpd
roads = gpd.read_parquet('data/processed/roads_enriched.parquet')
print(f'Roads: {len(roads)}')
print(f'Land status values: {roads.land_status.value_counts().to_dict()}')
"

# Verify places output
uv run python -c "
import geopandas as gpd
from pathlib import Path
p = Path('data/processed/places_hunt.parquet')
if p.exists():
    places = gpd.read_parquet(p)
    print(f'Hunt POIs: {len(places)}')
else:
    print('No places file (expected if places download not done)')
"
\`\`\`

## Risks/Edge Cases
- Places file may not exist if places download ticket not completed
- Spatial join may be slow with large datasets
- Memory issues with 1.2M road features

## Acceptance Criteria

03_enrich.py completes and creates roads_enriched.parquet
